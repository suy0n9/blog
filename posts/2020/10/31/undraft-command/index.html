<!doctype html><html xmlns=http://www.w3.org/1999/xhtml lang=ja-jp><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Hugoのundraftコマンドを再現する | suy0n9.com</title><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://suy0n9.com/css/custom.css><link rel=icon type=image/png ref=/favicon.ico><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://suy0n9.com/posts/2020/10/31/undraft-command/><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"></head><body><section class=section><div class=container><nav id=nav-main class=nav><div id=nav-name class=nav-left><a id=nav-anchor class=nav-item href=https://suy0n9.com><h1 id=nav-heading class="title is-4">suy0n9.com</h1></a></div><div class=nav-right><nav id=nav-items class="nav-item level is-mobile"><a class=level-item aria-label=github href=https://github.com/suy0n9 target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></i></span></a><a class=level-item aria-label=twitter href=https://twitter.com/suy0n9 target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></i></span></a></nav></div></nav></div><script src=/js/navicon-shift.js></script></section><section class=section><div class=container><h1 class=title>Hugoのundraftコマンドを再現する</h1><h2 class="subtitle is-6">October 31, 2020</h2><div class="subtitle tags is-6"><a class="subtitle is-6" href=/tags/blog/>#blog</a>
| <a class="subtitle is-6" href=/tags/hugo/>#hugo</a></div><div class=content><p>Hugoでブログを書く際に<a href=https://gohugo.io/content-management/archetypes/>Archetypes</a>を設定しdraftをtrueにしているのだが，記事を書き終わって<code>git push</code>する前にdraftをfalseにするのを毎回忘れてしまう．
更に<code>hugo new posts/&lt;filename>.md</code>でMarkdown作成時にタイムスタンプが付与されるが，記事を書き終えた後に再度タイムスタンプを書き換えるのが面倒だったので調べた．</p><h2 id=結果>結果</h2><p>どうやら<code>hugo undraft</code>コマンドがあったが，既にremoveされていた．<br><a href=https://discourse.gohugo.io/t/how-to-touch-the-date-after-undraft-is-deleted/10525>How to touch the date after <code>undraft</code> is deleted?</a></p><h2 id=解決策>解決策</h2><p>僕は記事を書き始めて日をまたぐ時が多々ある．そしてdraftで書きためておいて然るべきタイミングでpublishしたい時もあるので，上記にあるように簡易スクリプトで対応するようにした．</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e>#!/bin/sh
</span><span style=color:#75715e></span>
file<span style=color:#f92672>=</span>$1
now<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span><span style=color:#66d9ef>$(</span>date <span style=color:#e6db74>&#34;+%Y-%m-%dT%H:%M:%S%z&#34;</span> | sed -e <span style=color:#e6db74>&#39;s/00$/:00/&#39;</span><span style=color:#66d9ef>)</span><span style=color:#e6db74>&#34;</span>

<span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -f <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>file<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
    sed -i -e <span style=color:#e6db74>&#39;s/^date: 20.*$/date: &#39;</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>now<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>&#39;/&#39;</span> <span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>           -e <span style=color:#e6db74>&#39;s/^draft: true$/draft: false/&#39;</span> <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>file<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
    echo <span style=color:#e6db74>&#34;Update date: </span><span style=color:#e6db74>${</span>now<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
    echo <span style=color:#e6db74>&#34;Update draft: false&#34;</span>
<span style=color:#66d9ef>else</span>
    echo <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>file<span style=color:#e6db74>}</span><span style=color:#e6db74> not found&#34;</span>
    exit <span style=color:#ae81ff>1</span>
<span style=color:#66d9ef>fi</span>
exit <span style=color:#ae81ff>0</span>
</code></pre></div><p><code>date</code>コマンドで取得した<code>%z</code>のタイムゾーンでは<code>+hhmm</code>(+0900)形式になっている．しかし<a href=https://toml.io/en/v1.0.0-rc.3#offset-date-time>TOMLのoffset-date-time</a>では<code>+hh:mm</code>(+09:00)なので，<code>sed</code>で一度置換している．</p><p>上記をMacで実行する場合，<code>sed</code>がBSD版なのでGNU版を入れとかないと<code>-i</code>オプションがうまく動かない．</p><p>Homebrew でinstallする．</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ brew install gnu-sed
</code></pre></div><blockquote><p>If you need to use it as &ldquo;sed&rdquo;, you can add a &ldquo;gnubin&rdquo; directory to your PATH from your bashrc like:</p></blockquote><p><code>gsed</code>ではなく<code>sed</code>として利用できるようにパスを通す．</p><pre><code>PATH=&quot;/usr/local/opt/gnu-sed/libexec/gnubin:$PATH&quot;
</code></pre><h2 id=まとめ>まとめ</h2><p>しばらくこれで運用してみる．</p></div></div></section><section class=section><div class="container has-text-centered"><a href=https://suy0n9.com>Home</a><p>&copy; suy0n9 All Right Reserved.</p></div></section><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-103680121-3','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>