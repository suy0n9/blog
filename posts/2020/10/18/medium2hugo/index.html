<!doctype html><html xmlns=http://www.w3.org/1999/xhtml lang=ja-jp><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>MediumからHugoに移行した | suy0n9.com</title><link href=https://suy0n9.com/index.xml rel=alternate type=application/rss+xml title=suy0n9.com><link rel=stylesheet href=/css/style.css><link rel=stylesheet href=https://suy0n9.com/css/custom.css><link rel=icon type=image/png ref=/favicon.ico><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=canonical href=https://suy0n9.com/posts/2020/10/18/medium2hugo/><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"></head><body><section class=section><div class=container><nav id=nav-main class=nav><div id=nav-name class=nav-left><a id=nav-anchor class=nav-item href=https://suy0n9.com><h1 id=nav-heading class="title is-4">suy0n9.com</h1></a></div><div class=nav-right><nav id=nav-items class="nav-item level is-mobile"><a class=level-item aria-label=github href=https://github.com/suy0n9 target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77a5.44 5.44.0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></i></span></a><a class=level-item aria-label=twitter href=https://twitter.com/suy0n9 target=_blank rel=noopener><span class=icon><i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></i></span></a></nav></div></nav></div><script src=/js/navicon-shift.js></script></section><section class=section><div class=container><h1 class=title>MediumからHugoに移行した</h1><h2 class="subtitle is-6">October 18, 2020</h2><div class="subtitle tags is-6"><a class="subtitle is-6" href=/tags/blog/>#blog</a>
| <a class="subtitle is-6" href=/tags/hugo/>#hugo</a></div><div class=content><p>ブログをMediumからHugoに移行した．</p><h1 id=動機>動機</h1><p>主に以下の理由．</p><ul><li>Mediumの会員登録を促すポップアップが盛んになってきた</li><li>カスタムドメインを使いたい</li><li>記事をGit管理したくなった</li></ul><p>カスタムドメインはそのうち設定しようかと思ってのんびりしていたらdeprecationされていた.<br><a href=https://help.medium.com/hc/en-us/articles/115003053487-Custom-Domains-service-deprecation>Custom Domains service deprecation</a><br>なお，近々復活するみたいだが，時期は未定．</p><p>Git管理に関しては，「ブログサービスに一存するよりMarkdownで手元に記事を置いといた方がいざという時にサービスの運営を気にせず制御できる|安心感がある」みたいな話は良く目にしていたので, そうだなぁと思った次第．</p><p>これらの条件をすべて満たし，巷でよく使われているHugoにすべきかしばらく検討していた. 構築が面倒だったり凝りすぎて「書く」より「作る」になってしまいそうでずっと棚上げしていたが，重い腰を上げて移行した．</p><h1 id=hugoとは>Hugoとは</h1><p>Goで実装されている「Webサイト構築フレームワーク」だ．
使い方や詳細は<a href=https://gohugo.io/>公式サイト</a>に詳しく書かれているし，既に色んな人が書いているので以下略．</p><h1 id=移行について>移行について</h1><p>移行方法は<a href=https://gohugo.io/tools/migrations/#medium>公式ページ</a>で紹介されている<a href=https://github.com/gautamdhameja/medium-2-md>medium2md</a>を使用した.<br>Mediumからエクスポートしたデータをmedium2mdでMarkdownに変換することでほぼできた．</p><h3 id=変換がうまく行かなかった箇所>変換がうまく行かなかった箇所</h3><h4 id=記事内のurlのmarkdownタイトルが長くなる>記事内のURLのMarkdownタイトルが長くなる</h4><p>Markdown記法のURLタイトルに恐らく元のHTMLに含まれているカード型リンク内のサマリ文章までがタイトルになってしまい，とても長いリンクになっていた．
長い箇所は記事数がそんなに多くなかったのであまり深く考えず気づいた箇所だけ手直しした．．．</p><h4 id=snsなどのリンクの埋め込み>SNSなどのリンクの埋め込み</h4><p>HugoではMarkdownの中に簡易的な記述でTwitterやYouTubeなどを埋め込める<a href=https://gohugo.io/content-management/shortcodes/>Shortcode</a>という機能がある．</p><p><code>medium2md</code>で変換されたMarkdownにはTwitterの埋め込み箇所がまるっと欠損していた．僕の場合は特定の箇所でしかTwitterを参照していなかったので，以下の様な簡易スクリプトで<code>Shortcode</code>を生成して貼り付けた．</p><script type=application/javascript src=https://gist.github.com/suy0n9/739d95242a8c0946d1f313ff1fa593a2.js></script><p>YouTubeの埋め込み箇所はそのままURLに展開されていた．これまた使用箇所が少なかったので気づいたところのリンクを<code>Shortcode</code>で貼り直した．</p><h2 id=hosting--deployment>Hosting & Deployment</h2><p>構築したサイトはGithub Pagesで公開している．</p><p>基本的には以下の公式ページ通りにすればできる．</p><p><a href=https://gohugo.io/hosting-and-deployment/hosting-on-github/>Host on GitHub</a></p><p>少し迷った点として，Github Pagesでのサイト公開の方式が2のタイプあり, 公開方式によってデプロイ方式が複数パターンあった．</p><p>公開方式は以下の2つのパターン</p><ul><li>User/Organization Pages
<code>(https://&lt;USERNAME|ORGANIZATION>.github.io/)</code></li><li>Project Pages
<code>(https://&lt;USERNAME|ORGANIZATION>.github.io/&lt;PROJECT>/)</code></li></ul><p>上記の公開方式により，デプロイ方式が枝分かれする</p><ul><li><p><a href=https://gohugo.io/hosting-and-deployment/hosting-on-github/#github-user-or-organization-pages>GitHub User or Organization Pages</a></p><p>リポジトリを「Hugoの設定やソースコード，Markdown」と「レンダリングされたWebサイト」で分ける方式</p></li><li><p><a href=https://gohugo.io/hosting-and-deployment/hosting-on-github/#github-project-pages>GitHub Project Pages</a></p><ul><li><a href=https://gohugo.io/hosting-and-deployment/hosting-on-github/#deployment-of-project-pages-from-docs-folder-on-master-branch>Deployment of Project Pages from /docs folder on master branch</a><ul><li>Hugoの<code>publishDir</code>を<code>docs</code>に設定し，<code>master</code>ブランチで<code>docs</code>ディレクトリを公開</li></ul></li><li><a href=https://gohugo.io/hosting-and-deployment/hosting-on-github/#deployment-of-project-pages-from-your-gh-pages-branch>Deployment of Project Pages From Your gh-pages branch</a><ul><li><code>gh-pages</code>ブランチで公開</li></ul></li><li><a href=https://gohugo.io/hosting-and-deployment/hosting-on-github/#deployment-of-project-pages-from-your-master-branch>Deployment of Project Pages from Your master Branch</a><ul><li><code>public</code>ディレクトリをrootとして<code>master</code>ブランチで公開</li></ul></li></ul></li></ul><p>最初は<code>User/Organization Pages</code>方式でリポジトリを分けて構築した．この方式の場合，ビルドして生成される<code>public</code>ディレクトリを<code>submodule</code>化しリポジトリを分けているので，<code>deploy.sh</code>なるものを用意してデプロイする．
しかし次第にリポジトリを2つに分けている事に煩わしさを感じてリポジトリを1つにし<code>gh-pages</code>ブランチで公開する様に変更した．</p><h3 id=デプロイ自動化>デプロイ自動化</h3><p>Github Actionでデプロイを自動化した．利用したのは以下で，どちらかの<code>Getting Started</code>通りに<code>.github/workflows/gh-pages.yml</code>を作成し，<code>master</code>ブランチに<code>push</code>するだけで<code>gh-pages</code>ブランチに公開される様になった．</p><ul><li><a href=https://github.com/peaceiris/actions-hugo>GitHub Actions for Hugo</a></li><li><a href=https://github.com/peaceiris/actions-gh-pages>GitHub Actions for GitHub Pages</a></li></ul><p>少しハマった所として，<a href=https://docs.github.com/en/free-pro-team@latest/github/working-with-github-pages/managing-a-custom-domain-for-your-github-pages-site>Managing a custom domain for your GitHub Pages site</a>に従い設定したカスタムドメイン用の<code>CNAME</code>ファイルがデプロイ時に消えてしまい，リポジトリ -> Settings -> Custom domain の値が元に戻ってサイトが見れないようになってしまった．</p><p><a href=https://github.com/peaceiris/actions-gh-pages>GitHub Actions for GitHub Pages</a>側の <code>README</code>をよく読むと<code>CNAME</code>ファイルを追加するオプションがあった．</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Deploy</span>
  <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>peaceiris/actions-gh-pages@v3</span>
  <span style=color:#f92672>with</span>:
    <span style=color:#f92672>github_token</span>: <span style=color:#ae81ff>${{ secrets.GITHUB_TOKEN }}</span>
    <span style=color:#f92672>publish_dir</span>: <span style=color:#ae81ff>./public</span>
    <span style=color:#f92672>cname</span>: <span style=color:#ae81ff>github.com</span>
</code></pre></div><p><code>REAMDE</code>をよく読む事の重要性を再認識した．</p><h1 id=移行してみて>移行してみて</h1><p>記事をMarkdownで書いてGit管理し，自分のドメインでサイトを公開し，サイトデザインは<a href=https://themes.gohugo.io/>Theme</a>がたくさん公開されていて自作もできるので，トータルで満足している．</p><p>細かい設定やタグ機能，デザインなどは少しずつ修正していきたい．</p><h1 id=まとめ>まとめ</h1><p>いつものペースでたまに更新すると扱い方を忘れそうなので(デプロイ自動化したから大丈夫なはず)，これを機に定期的に書いていきたい．</p></div></div></section><section class=section><div class="container has-text-centered"><a href=https://suy0n9.com>Home</a><p>&copy; suy0n9 All Right Reserved.</p></div></section><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-103680121-3','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>